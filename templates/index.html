<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bomb SCADA</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    #log { border: 1px solid #ccc; padding: 12px; height: 240px; overflow:auto; }
    button { margin-right: 8px; }
    .ok { color: green; }
    .bad { color: red; }
  </style>
</head>
<body>
  <h2>Bomb SCADA (LV6 WebSocket)</h2>

  <div>Connection: <span id="st" class="bad">DISCONNECTED</span></div>
  <div>Armed: <span id="armed">?</span> | Exploded: <span id="exploded">?</span></div>
  <br>

  <button onclick="sendCmd('ARM')">ARM</button>
  <button onclick="sendCmd('RESET')">RESET</button>
  <button onclick="sendCmd('STATUS')">STATUS</button>

  <h3>Log</h3>
  <div id="log"></div>

<script>
  const st = document.getElementById('st');
  const log = document.getElementById('log');
  const armed = document.getElementById('armed');
  const exploded = document.getElementById('exploded');

  const wsUrl = `ws://${location.host}/ws`;
  const ws = new WebSocket(wsUrl);

  ws.onopen = () => { st.textContent = "CONNECTED"; st.className = "ok"; };
  ws.onclose = () => { st.textContent = "DISCONNECTED"; st.className = "bad"; };
  ws.onerror = () => { st.textContent = "ERROR"; st.className = "bad"; };

  ws.onmessage = (ev) => {
    let obj;
    try { obj = JSON.parse(ev.data); } catch { obj = {type:"raw", line: ev.data}; }

    if (obj.armed !== undefined) armed.textContent = obj.armed;
    if (obj.exploded !== undefined) exploded.textContent = obj.exploded;

    const line = document.createElement('div');
    line.textContent = `[${obj.type}] ${obj.msg || obj.line || ev.data}`;
    log.appendChild(line);
    log.scrollTop = log.scrollHeight;
  };

  function sendCmd(cmd) {
    ws.send(cmd);
  }
</script>
</body>
</html>